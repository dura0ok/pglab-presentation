<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–æ–∫–ª–∞–¥ Postgres-Pro –î—É—Ä–∞—á–æ–∫ –ì–ª—É–ø—ã–π</title>
    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/theme/black.css">
    <link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <h1 class="r-fit-text">–≠–º—É–ª—è—Ü–∏—è —Å–±–æ–µ–≤ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º</h1>
                <img src="images/mem5.png" alt="">
                <aside class="notes">
                    –¢–µ–º–∞ –º–æ–µ–≥–æ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–æ–∫–ª–∞–¥–∞ —ç–º—É–ª—è—Ü–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–±–æ–µ–≤ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º.
                    –°–Ω–∞—á–∞–ª–æ –∫—Ä–∞—Ç–∫–æ —Ö–æ—á—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –≤ —Ü–µ–ª–æ–º –æ —Ç–æ–º, —á—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, –ø–æ—Ç–æ–º —Å–¥–µ–ª–∞—é –æ–±–∑–æ—Ä
                    –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –Ω–∞ —á—ë–º –æ–Ω–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã. –ü–æ–∫–∞–∂—É –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –∫–∞–∫ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, —Ç–∞–∫ –∏ –Ω–∞–ø–∏—à–µ–º –ø–∞—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤ —Å –Ω—É–ª—è.
                </aside>
            </section>
            <section>
                <h2 class="r-fit-text">–ö—Ä–∞—Ç–∫–æ –æ —Ç–æ–º –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞</h2>
                <img src="images/mem10.png" alt="">
                <aside class="notes">
                    –§–° Linux ‚Äî –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Ä–∞–∑–¥–µ–ª–∞, –ø–æ–¥–µ–ª–µ–Ω–Ω–æ–µ –Ω–∞ –±–ª–æ–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.
                    –û–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫—Ä–∞—Ç–Ω–æ—Å—Ç—å—é —Ä–∞–∑–º–µ—Ä—É —Å–µ–∫—Ç–æ—Ä–∞. 
                    –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, —ç—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å 1024, 2048, 4096 –∏–ª–∏ 8120 –±–∞–π—Ç. 
                    –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ —Ä–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –∏–∑–≤–µ—Å—Ç–µ–Ω –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º –§–° 
                    –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–¥–≤–∏–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫ –∫–∞–∂–¥–æ–º—É –∏–∑ –±–ª–æ–∫–æ–≤.
                    –î–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å—Ä–∞–∑—É –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞. 
                    –ü–µ—Ä–≤—ã–π –∏–∑ –Ω–∏—Ö ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (VFS). 
                    –° –ø–æ–º–æ—â—å—é –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –§–° –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —è–¥—Ä–∞ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–µ. 
                    VFS –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–µ —É—á–∏—Ç—ã–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –§–°. 
                    –í—Ç–æ—Ä–æ–π —Å–ø–æ—Å–æ–± ‚Äî –¥—Ä–∞–π–≤–µ—Ä—ã —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º. –ò–º–µ–Ω–Ω–æ –æ–Ω–∏ –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ —Å–≤—è–∑—å –º–µ–∂–¥—É ¬´–∂–µ–ª–µ–∑–æ–º¬ª –∏ —Å–æ—Ñ—Ç–æ–º.
                    –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —è–¥—Ä–æ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ /proc/filesystems:
                    –í –§–° –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º ‚Äî 
                    Inode (–æ—Ç –∞–Ω–≥–ª. index node ‚Äî ¬´–∏–Ω–¥–µ–∫—Å–Ω—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä¬ª).
                    –ù–æ –ø—Ä–∏ —ç—Ç–æ–º –æ–¥–∏–Ω —Ñ–∞–π–ª (—Ä–µ—á—å –æ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏) –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–º–µ–Ω (–∏–ª–∏ –ø—É—Ç–µ–π). 
                    –ò –µ—Å–ª–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –§–° —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è, —Ç–æ –Ω–∞ –∂–µ—Å—Ç–∫–æ–º –¥–∏—Å–∫–µ –∏–º –º–æ–∂–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ñ–∞–π–ª. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –§–° Linux –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω–æ-–∏–µ—Ä–∞—Ä—Ö–∏—á–Ω–∞, –∞ –≤–µ—Ç–≤–∏ –¥–µ—Ä–µ–≤–∞ –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è.
                    –ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º –§–° (–¥—Ä–∞–π–≤–µ—Ä). 
                    –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¥—Ä–∞–π–≤–µ—Ä—É. –ò–º–µ–Ω–Ω–æ –æ–Ω –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –§–°.
                    –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, —è–¥—Ä–æ –∑–∞–Ω–æ—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–∫–∞–∫–∏–º –¥—Ä–∞–π–≤–µ—Ä–æ–º –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç—Å—è –∏ –≥–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã —Ñ–∞–π–ª—ã –∏ –∫–∞—Ç–∞–ª–æ–≥–∏) –≤ —Ç–∞–±–ª–∏—Ü—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. 
                    –û–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ /proc/mounts.
                </aside>
            </section>
            <section data-background-color="white">
                –î–∏–∑–∞–π–Ω —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
                <img src="images/fs-design.png" alt="">
                <aside class="notes">
                    <p>–ü–µ—Ä–≤—ã–π –±–ª–æ–∫ –¥–∏—Å–∫–∞ - —ç—Ç–æ —Å—É–ø–µ—Ä–±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤, —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞ —Å—É–ø–µ—Ä–±–ª–æ–∫–æ–º, —Å–æ–¥–µ—Ä–∂–∞—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö inode. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –¥–µ—Å—è—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –æ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∏—Å–∫–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–ª–æ–∫–æ–≤ inode. –û—Å—Ç–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>
                    <p>–≠—Ç–æ—Ç —Å—É–ø–µ—Ä–±–ª–æ–∫ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —á–µ—Ç—ã—Ä–µ—Ö –ø–æ–ª–µ–π:</p>
                    <ol>
                        <li>
                            <strong>MAGIC_NUMBER</strong> –∏–ª–∏ 0xf0f03410. –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–º–µ—â–∞–µ—Ç —ç—Ç–æ —á–∏—Å–ª–æ –≤ —Å–∞–º—ã–µ –ø–µ—Ä–≤—ã–µ –±–∞–π—Ç—ã —Å—É–ø–µ—Ä–±–ª–æ–∫–∞ –∫–∞–∫ —Å–≤–æ–µ–≥–æ —Ä–æ–¥–∞ "–ø–æ–¥–ø–∏—Å—å" —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã. –ö–æ–≥–¥–∞ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞, –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç —ç—Ç–æ –º–∞–≥–∏—á–µ—Å–∫–æ–µ —á–∏—Å–ª–æ. –ï—Å–ª–∏ –æ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ, —Ç–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –¥–∏—Å–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–ø—É—Å—Ç–∏–º—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É. –ï—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–∞–∫–æ–µ-–ª–∏–±–æ –¥—Ä—É–≥–æ–µ —á–∏—Å–ª–æ, —Ç–æ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ—É–¥–∞—á–Ω–æ, –≤–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ç–æ–º—É, —á—Ç–æ –¥–∏—Å–∫ –Ω–µ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∫–∏–µ-–ª–∏–±–æ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ.
                        </li>
                        <li><strong>–ë–ª–æ–∫–∏:</strong> –í—Ç–æ—Ä–æ–µ –ø–æ–ª–µ - —ç—Ç–æ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤, –∫–æ—Ç–æ—Ä–æ–µ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –±–ª–æ–∫–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ.</li>
                        <li><strong>InodeBlocks:</strong> –¢—Ä–µ—Ç—å–µ –ø–æ–ª–µ - —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤, –æ—Ç–≤–µ–¥–µ–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤. –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã–±–æ—Ä —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å 10% –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª–æ–∫–æ–≤ —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É.</li>
                        <li><strong>–ò–Ω–¥–µ–∫—Å—ã:</strong> –ß–µ—Ç–≤–µ—Ä—Ç–æ–µ –ø–æ–ª–µ - —ç—Ç–æ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ —ç—Ç–∏—Ö –±–ª–æ–∫–∞—Ö –∏–Ω–¥–µ–∫—Å–æ–≤.</li>
                    </ol>
                    <p>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å—É–ø–µ—Ä–±–ª–æ–∫–∞ –¥–æ–≤–æ–ª—å–Ω–æ –º–∞–ª–∞: –≤—Å–µ–≥–æ 16 –±–∞–π—Ç. –û—Å—Ç–∞–≤—à–∞—è—Å—è —á–∞—Å—Ç—å –Ω—É–ª–µ–≤–æ–≥–æ –¥–∏—Å–∫–æ–≤–æ–≥–æ –±–ª–æ–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π.</p>
                </aside>
            </section>
            <section data-background-color="white">
                –î–∏–∑–∞–π–Ω INode
                <img src="images/inode-design.png" alt="">
            </section>
            <section data-background-color="white">
                <img src="images/hard-links.png" alt="">
            </section>
            <section data-background-color="white">
                <h1 class="r-fit-text">–ü—Ä–∏–º–µ—Ä —Ç–æ–≥–æ, —á—Ç–æ –º–æ–∂–µ–º —Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å?</h1>
                <ul>
                    <li>–ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å inode ü™π</li>
                    <li>–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è ‚ùå</li>
                    <li>–ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π üê¢ ü¶•</li>
                    <li>–ü–æ—Å–ª–∞—Ç—å SIGKILL –≤ –æ—Ç–≤–µ—Ç ü§°</li>
                </ul>
            </section>
            <section>
                <img src="images/fault-tools.png" alt="">
            </section>
            <section>
                <table>
                    <thead>
                        <tr>
                            <th>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th>
                            <th>–°—Å—ã–ª–∫–∞/–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>CharybdeFS</td>
                            <td style="font-size: 24px;">
                                <a href="https://github.com/scylladb/charybdefs">github</a>
                                <br>
                                –ù–∞ Ubuntu > 16 –Ω–µ—Ç –ø–∞–∫–µ—Ç–æ–≤, –∞ –Ω–∞ 16 –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –Ω–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
                            </td>
                        </tr>
                        <tr>
                            <td>PetardFS</td>
                            <td style="font-size: 24px;">
                                <a href="https://github.com/jrandall/petardfs">github</a>
                                <br>
                                –ü—Ä–æ–µ–∫—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –æ–±–Ω–æ–≤–ª—è–ª—Å—è 10 –ª–µ—Ç –Ω–∞–∑–∞–¥, –ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ —Å—Ç–∞–ª
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section>
                <table>
                    <thead>
                        <tr>
                            <th>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th>
                            <th>–°—Å—ã–ª–∫–∞/–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>UnreliableFS</td>
                            <td style="font-size: 24px;">
                                <a href="https://github.com/ligurio/unreliablefs">github</a>
                                <br>
                                –ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç —Å–∞–º–∞—è —Å–≤–µ–∂–∞—è —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ –¥–ª—è —Å–±–æ–µ–≤. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –¥–∞–ª–µ–µ
                                <!-- TODO: –í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Å–ª–∞–π–¥ –≥–¥–µ –±—É–¥–µ—Ç UnreliableFS  -->
                            </td>
                        </tr>
                        <tr>
                            <td>libeatmydata</td>
                            <td style="font-size: 24px;">
                                <a href="https://github.com/stewartsmith/libeatmydata">github</a>
                                <br>
                                LD_PRELOAD, –æ—Ç–∫–ª—é—á–∞–µ—Ç –≤—Å–µ —Ñ–æ—Ä–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫(fsync, O_SYNC)
                                <br>
                                –ú–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞, –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section>
                <table>
                    <thead>
                        <tr>
                            <th>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th>
                            <th>–°—Å—ã–ª–∫–∞/–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>cleancache</td>
                            <td style="font-size: 24px;">
                                <a href="https://github.com/kahing/bin/blob/master/cleancache.c">github</a>
                                <br>
                                –£–¥–∞–ª—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ –∫—ç—à–∞ –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è(LD_PRELOAD)
                                <br>
                                –ó–∞–ø—É—Å–∫–∞–ª, –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ö–æ—Ä–æ—à–æ –∑–∞–º–µ–¥–ª–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã
                            </td>
                        </tr>
                        <tr>
                            <td>Device mapper</td>
                            <td style="font-size: 24px;">
                                <a href="https://www.kernel.org/doc/Documentation/device-mapper/dm-flakey.txt">Kernel.org</a>
                                <br>
                                –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –±–ª–æ—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤,
                                –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º —É–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ —Ñ—É–Ω–∫—Ü–∏–∏,
                                —Ç–∞–∫–∏–µ –∫–∞–∫ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏,
                                —Å–±–æ–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –±–∞–π—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–µ–Ω–∞–¥–µ–∂–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section>
                <table>
                    <thead>
                        <tr>
                            <th>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th>
                            <th>–°—Å—ã–ª–∫–∞/–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>QEMU</td>
                            <td style="font-size: 24px;">
                                <a href="https://github.com/qemu/qemu/blob/master/docs/devel/blkdebug.txt">github</a>
                                <br>
                                –î—Ä–∞–π–≤–µ—Ä –±–ª–æ–∫–∞ blkdebug - —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º —Å–∏–º—É–ª—è—Ü–∏–∏ –æ—à–∏–±–æ–∫. –ï–≥–æ –º–æ–∂–Ω–æ
                                –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –æ—à–∏–±–æ–∫ –±–ª–æ—á–Ω—ã—Ö –¥—Ä–∞–π–≤–µ—Ä–∞—Ö(–ù–µ—Ç –ø–∞–º—è—Ç–∏/–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è, –∑–∞–ø–∏—Å–∏..)
                                <br><br>
                                –í —è–¥—Ä–µ, –ø–æ—ç—Ç–æ–º—É –±—ã—Å—Ç—Ä–æ, –Ω–æ –æ–ø–∞—Å–Ω–æ –∏ –æ—á–µ–Ω—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–∑–∞–≤–∏—Å–∏–º–æ
                            </td>
                        </tr>
                        <tr>
                            <td>sysrq</td>
                            <td style="font-size: 24px;">
                                <a href="https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html">Kernel.org</a>
                                <br>
                                –ö–æ–º–∞–Ω–¥–∞ "echo c > /proc/sysrq-trigger" –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞–Ω–∏–∫—É —è–¥—Ä–∞, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞—è —Å–∏—Å—Ç–µ–º—É –≤ —Å–ª—É—á–∞–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section>
                <table>
                    <thead>
                        <tr>
                            <th>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç</th>
                            <th>–°—Å—ã–ª–∫–∞/–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Linux kernel fault injection capabilities infrastructure</td>
                            <td style="font-size: 24px;">
                                <a href="https://www.kernel.org/doc/html/latest/fault-injection/fault-injection.html">Kernel.org</a>
                                <br>
                                –°–∏–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ –±–∞–∑–æ–≤—ã—Ö –±–ª–æ—á–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –≤–∫–ª—é—á–∏–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä —è–¥—Ä–∞ FAIL_MAKE_REQUEST
                            </td>
                        </tr>
                        <tr>
                            <td>libfiu</td>
                            <td style="font-size: 24px;">
                                <a href="http://blitiri.com.ar/p/libfiu/">–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é</a>
                                <br>
                                (LD_PRELOAD) –ó–∞–º–µ–Ω–∞ posix api calls.<br>
                                –ú–∏–Ω—É—Å—ã - –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–∞ –¥–∞–∂–µ —Å BSD –∏ –Ω–µ—É–¥–æ–±–Ω—ã–π API
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>
            <section>
                <h2 class="r-fit-text">FUSE - FileSystem in <b>USER</b> space</h2>
                <img src="images/fuse.jpg" alt="">
            </section>
            <section>
                <h1 class="r-fit-text">–ê —ç—Ç–æ –≤–æ–æ–±—â–µ –∫—Ç–æ-—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç?</h1>
                <p class="r-fit-text">–°—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ FUSE, –∫–æ—Ç–æ—Ä—ã–µ —Å–ø–æ—Å–æ–±–Ω—ã –ø—Ä–∏–Ω–µ—Å—Ç–∏ —Ç–µ–º, –∫—Ç–æ –∏—Ö –ø—Ä–∏–º–µ–Ω—è–µ—Ç, —Ä–µ–∞–ª—å–Ω—É—é –ø–æ–ª—å–∑—É. –í–æ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑:</p>
                <ul class="r-fit-text">
                    <li><a href="https://hackaday.com/2019/12/17/linux-fu-stupid-ssh-tricks/">sshfs</a> ‚Äî –º–æ–Ω—Ç–∏—Ä—É–µ—Ç —É–¥–∞–ª—ë–Ω–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, –∏—Å–ø–æ–ª—å–∑—É—è –ª–∏—à—å ssh-–¥–æ—Å—Ç—É–ø.</li>
                    <li><a href="https://hackaday.com/2020/11/10/linux-fu-send-in-the-cloud-clones/">rclone</a> ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –º–Ω–æ–≥–∏–º —É–¥–∞–ª—ë–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–≤—ã–º —Å–∏—Å—Ç–µ–º–∞–º –∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å –∏—Ö –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.</li>
                    <li><a href="http://www.tagsistant.net/">tagsistant</a> ‚Äî —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ —Ç–µ–≥–∞—Ö, –æ–±–ª–µ–≥—á–∞—é—â–∞—è —Ä–∞–±–æ—Ç—É —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ñ–∞–π–ª–æ–≤.</li>
                    <li><a href="https://linux.die.net/man/1/fuse-zip">fuse-zip</a> ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å zip-—Ñ–∞–π–ª—ã –≤ –≤–∏–¥–µ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º.</li>
                    <li><a href="https://www.presslabs.com/docs/code/gitfs/">gitfs</a> ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –≤–∏–¥–µ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.</li>
                </ul>
            </section>
            <section>
                <h2 class="r-fit-text">–ê –∫–∞–∫ –Ω–∞—Å—á—ë—Ç Windows?</h2>
                <p class="r-fit-text">
                    –í Windows –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç <a href="https://github.com/billziss-gh/winfsp">WinFsp</a>, –≤–∫–ª—é—á–∞—è —Å–ª–æ–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å FUSE –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è
                    –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ FUSE-–∫–æ–¥–∞.<br>
                    –î—Ä—É–≥–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è Windows ‚Äî –ø—Ä–æ–µ–∫—Ç <a href="https://github.com/dokan-dev/dokany/">Dokan</a>, –ø—Ä–µ–¥–ª–∞–≥–∞—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∫ —Å–≤–æ–µ–º—É
                    API –¥–ª—è FUSE, —Ö–æ—Ç—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –±–µ–Ω—á–º–∞—Ä–∫–æ–≤ WinFsp –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
                </p>
            </section>
            <section>
                <h1 class="r-fit-text">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ UnreliableFS</h1>
                <pre><code data-trim data-noescape>
                    $ git clone git@github.com:ligurio/unreliablefs.git
                    $ cmake -S . -B build -DCMAKE_BUILD_TYPE=Debug
                    $ cmake --build build --parallel
                    $ mkdir mntpoint bsdir
                    $ cat << EOF > /tmp/fs/unreliablefs.conf
                    [errinj_noop]
                    op_regexp = read
                    path_regexp = .*
                    probability = 30
                    EOF
                    $ ./unreliablefs mntpoint -basedir=bsdir -seed=1618680646 -f
                </code></pre>
            </section>
            <section>
                <h1 class="r-fit-text">–ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã UnreliableFS</h1>
                <img src="images/mem4.png" alt="">
            </section>
            <section>
                <h1 class="r-fit-text">–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã UnreliableFS</h1>
                <img src="images/example-simple-work.png" alt="">
            </section>
            <section>
                <h1 class="r-fit-text">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ <a href="https://ligurio.github.io/unreliablefs/unreliablefs.1.html">–æ–ø–µ—Ä–∞—Ü–∏–∏</a> –¥–ª—è –∏–Ω—å–µ–∫—Ü–∏–∏–∏ UnreliableFS</h1>
                <img src="images/supported-options.png" alt="">
            </section>
            <section>
                <h1 class="r-fit-text">–ü–æ—á–µ–º—É —Ä–µ—à–∏–ª –ø–∏—Å–∞—Ç—å —Å –Ω—É–ª—è?</h1>
                <h2 class="r-fit-text">–í UnreliableFS –º–Ω–æ–≥–æ –±–∞–≥–æ–≤, –ø—Ä–æ–µ–∫—Ç —Ö–æ—Ç—å –∏ —Å–≤–µ–∂–∏–π –Ω–æ –Ω–µ –∂–∏–≤–æ–π, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ—â–µ –ø–æ–¥ —Å–≤–æ–∏ –∑–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É—è —É–¥–æ–±–Ω–æ–µ api –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ–µ</h2>
            </section>
            <section data-background-color="white">
                <h1 class="r-fit-text">Issues Unreliable fs</h1>
                <img src="images/2023120602034.svg" alt="">
            </section>
            <section>
                <h2 class="r-fit-text">–ü–æ–¥–Ω–∏–º–∞–µ–º —Å–≤–æ—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏—Å–ø–æ–ª—å–∑—É—è pyfuse</h2>    
                <aside class="notes">
                    This Python expression creates a dictionary based on the provided file or directory attributes stored in the st object (presumably a stat object, representing file metadata). Here's what each attribute represents:

1. st_atime: The time of last access (in seconds since the epoch).
2. st_ctime: The time of last status change (in seconds since the epoch). This includes metadata changes such as permission changes.
3. st_gid: The group ID of the file.
4. st_mode: The file's mode (permissions).
5. st_mtime: The time of last modification (in seconds since the epoch).
6. st_nlink: The number of hard links to the file.
7. st_size: The size of the file in bytes.
8. st_uid: The user ID of the file owner.

                </aside>
                <pre><code data-line-numbers="21-28|30-40|1-88|" data-trim data-noescape style="font-size: 15px;">
#!/usr/bin/env python

import os
import sys
import random
from fuse import FUSE, FuseOSError, Operations

class SimpleFS(Operations):
    def __init__(self, basedir):
        self.basedir = basedir

    def getattr(self, path, fh=None):
        full_path = self._full_path(path)
        try:
            st = os.lstat(full_path)
            return dict((key, getattr(st, key)) for key in ('st_atime', 'st_ctime',
                         'st_gid', 'st_mode', 'st_mtime', 'st_nlink', 'st_size', 'st_uid'))
        except FileNotFoundError:
            raise FuseOSError(2) 

    def readdir(self, path, fh):
        full_path = self._full_path(path)
        try:
            dirents = ['.', '..'] + [f.name for f in os.scandir(full_path)]
            for r in dirents:
                yield r
        except FileNotFoundError:
            raise FuseOSError(2) 

    def read(self, path, size, offset, fh):
        full_path = self._full_path(path)
        try:
            with open(full_path, 'rb') as f:
                data = f.read()
                # 50% probability of no-op
                if random.random() < 0.5:
                    return b''  # Return empty data as a no-op
                return data[offset:offset + size]
        except FileNotFoundError:
            raise FuseOSError(2)  
    def write(self, path, data, offset, fh):
        full_path = self._full_path(path)
        try:
            with open(full_path, 'r+b') as f:
                f.seek(offset)
                f.write(data)
                return len(data)
        except FileNotFoundError:
            raise FuseOSError(2) 

    def mkdir(self, path, mode):
        full_path = self._full_path(path)
        try:
            os.mkdir(full_path, mode)
        except FileExistsError:
            raise FuseOSError(17) 
        except FileNotFoundError:
            raise FuseOSError(2) 

    def rmdir(self, path):
        full_path = self._full_path(path)
        try:
            os.rmdir(full_path)
        except FileNotFoundError:
            raise FuseOSError(2) 

    def unlink(self, path):
        full_path = self._full_path(path)
        try:
            os.unlink(full_path)
        except FileNotFoundError:
            raise FuseOSError(2) 

    def _full_path(self, partial):
        if partial.startswith("/"):
            partial = partial[1:]
        path = os.path.join(self.basedir, partial)
        return path

if __name__ == '__main__':
    if len(sys.argv) != 3:
        print("Usage: {} mountpoint basedir".format(sys.argv[0]))
        sys.exit(1)

    mountpoint = sys.argv[1]
    basedir = sys.argv[2]

    fuse = FUSE(SimpleFS(basedir), mountpoint, foreground=True)

                </code></pre>
            </section>
            <section>
                <p>–ó–∞–ø—É—Å—Ç–∏–º –Ω–∞—à—É —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É</p>
                <img src="images/custom-fuse-python-working.png" alt="">
            </section>
            <section>
                <p class="r-fit-text">–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∫–æ–¥ –Ω–∞ C</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 15px;">
#define FUSE_USE_VERSION 30
#include &lt;fuse.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;dirent.h&gt;
#include &lt;limits.h&gt;


struct PassthroughData {
    const char *root_path;
};

static int passthrough_getattr(const char *path, struct stat *stbuf, struct fuse_file_info *fi) {
    struct PassthroughData *data = (struct PassthroughData *)fuse_get_context()->private_data;

    char full_path[PATH_MAX];
    snprintf(full_path, sizeof(full_path), "%s%s", data->root_path, path);

    int res = lstat(full_path, stbuf);
    if (res == -1)
        return -errno;

    return 0;
}

static int passthrough_readdir(const char *path, void *buf, fuse_fill_dir_t filler, off_t offset, struct fuse_file_info *fi) {
    struct PassthroughData *data = (struct PassthroughData *)fuse_get_context()->private_data;

    char full_path[PATH_MAX];
    snprintf(full_path, sizeof(full_path), "%s%s", data->root_path, path);

    DIR *dp = opendir(full_path);
    if (dp == NULL)
        return -errno;

    struct dirent *de;
    while ((de = readdir(dp)) != NULL) {
        if (filler(buf, de->d_name, NULL, 0))
            break;
    }

    closedir(dp);
    return 0;
}

static int passthrough_open(const char *path, struct fuse_file_info *fi) {
    struct PassthroughData *data = (struct PassthroughData *)fuse_get_context()->private_data;

    char full_path[PATH_MAX];
    snprintf(full_path, sizeof(full_path), "%s%s", data->root_path, path);

    int fd = open(full_path, fi->flags);
    if (fd == -1)
        return -errno;

    fi->fh = fd;
    return 0;
}

static int passthrough_read(const char *path, char *buf, size_t size, off_t offset, struct fuse_file_info *fi) {
    double random_value = (double)rand() / RAND_MAX;

    if (random_value < 0.5) {
        return 0;
    }

    ssize_t res = pread(fi->fh, buf, size, offset);
    if (res == -1) {
        return -errno;
    }

    return res;
}

static struct fuse_operations passthrough_operations = {
    .getattr = (int (*)(const char *, struct stat *))passthrough_getattr,
    .readdir = passthrough_readdir,
    .open = passthrough_open,
    .read = passthrough_read,
};

int main(int argc, char *argv[]) {
    if (argc != 3) {
        fprintf(stderr, "Usage: %s <root> <mountpoint>\n", argv[0]);
        exit(EXIT_FAILURE);
    }

    struct PassthroughData data;
    data.root_path = realpath(argv[1], NULL);
    if (data.root_path == NULL) {
        perror("realpath");
        exit(EXIT_FAILURE);
    }

    argc--;
    argv++;
    return fuse_main(argc, argv, &passthrough_operations, &data);
}

                </code></pre>
            </section>
            <section>
                <p class="r-fit-text">–ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥ –Ω–∞ —è–∑—ã–∫–µ C</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 15px;">
               $ fusermount -u ~/workspace/c-fuse-exps/mntpoint 
               $ gcc main.c -o main -lfuse -D_FILE_OFFSET_BITS=64
               $ ./main bsdir mntpoint
            </code></pre>
            </section>
            <section>
                <p class="r-fit-text">–î–æ–±–∞–≤–∏–º –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –ø–µ—Ä–µ–ø–∏—à–µ–º –∫–æ–¥, —Å–¥–µ–ª–∞–≤ –µ–≥–æ —á–∏—Ç–∞–µ–º–µ–µ</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 15px;">
#!/usr/bin/env python

from __future__ import with_statement

import os
import sys
import random
import errno

from fuse import FUSE, FuseOSError, Operations, fuse_get_context


class Passthrough(Operations):
    def __init__(self, root):
        self.root = root

    # Helpers
    # =======

    def _full_path(self, partial):
        if partial.startswith("/"):
            partial = partial[1:]
        path = os.path.join(self.root, partial)
        return path

    # Filesystem methods
    # ==================

    def access(self, path, mode):
        full_path = self._full_path(path)
        if not os.access(full_path, mode):
            raise FuseOSError(errno.EACCES)

    def chmod(self, path, mode):
        full_path = self._full_path(path)
        return os.chmod(full_path, mode)

    def chown(self, path, uid, gid):
        full_path = self._full_path(path)
        return os.chown(full_path, uid, gid)

    def getattr(self, path, fh=None):
        full_path = self._full_path(path)
        st = os.lstat(full_path)
        return dict((key, getattr(st, key)) for key in ('st_atime', 'st_ctime',
                     'st_gid', 'st_mode', 'st_mtime', 'st_nlink', 'st_size', 'st_uid'))

    def readdir(self, path, fh):
        full_path = self._full_path(path)

        dirents = ['.', '..']
        if os.path.isdir(full_path):
            dirents.extend(os.listdir(full_path))
        for r in dirents:
            yield r

    def readlink(self, path):
        pathname = os.readlink(self._full_path(path))
        if pathname.startswith("/"):
            # Path name is absolute, sanitize it.
            return os.path.relpath(pathname, self.root)
        else:
            return pathname

    def mknod(self, path, mode, dev):
        return os.mknod(self._full_path(path), mode, dev)

    def rmdir(self, path):
        full_path = self._full_path(path)
        return os.rmdir(full_path)

    def mkdir(self, path, mode):
        return os.mkdir(self._full_path(path), mode)

    def statfs(self, path):
        full_path = self._full_path(path)
        stv = os.statvfs(full_path)
        return dict((key, getattr(stv, key)) for key in ('f_bavail', 'f_bfree',
            'f_blocks', 'f_bsize', 'f_favail', 'f_ffree', 'f_files', 'f_flag',
            'f_frsize', 'f_namemax'))

    def unlink(self, path):
        return os.unlink(self._full_path(path))

    def symlink(self, name, target):
        return os.symlink(target, self._full_path(name))

    def rename(self, old, new):
        return os.rename(self._full_path(old), self._full_path(new))

    def link(self, target, name):
        return os.link(self._full_path(name), self._full_path(target))

    def utimens(self, path, times=None):
        return os.utime(self._full_path(path), times)

    # File methods
    # ============

    def open(self, path, flags):
        full_path = self._full_path(path)
        return os.open(full_path, flags)

    def create(self, path, mode, fi=None):
        uid, gid, pid = fuse_get_context()
        full_path = self._full_path(path)
        fd = os.open(full_path, os.O_WRONLY | os.O_CREAT, mode)
        os.chown(full_path,uid,gid) #chown to context uid & gid
        return fd

    def read(self, path, length, offset, fh):
        # Add a read no-op operation with 50% probability
        if random.random() < 0.5:
            return b''  # Return an empty byte string as a no-op
        else:
            os.lseek(fh, offset, os.SEEK_SET)
            return os.read(fh, length)

    def write(self, path, buf, offset, fh):
        os.lseek(fh, offset, os.SEEK_SET)
        return os.write(fh, buf)

    def truncate(self, path, length, fh=None):
        full_path = self._full_path(path)
        with open(full_path, 'r+') as f:
            f.truncate(length)

    def flush(self, path, fh):
        return os.fsync(fh)

    def release(self, path, fh):
        return os.close(fh)

    def fsync(self, path, fdatasync, fh):
        return self.flush(path, fh)


def main(mountpoint, root):
    FUSE(Passthrough(root), mountpoint, nothreads=True, foreground=True, allow_other=True)


if __name__ == '__main__':
    main(sys.argv[2], sys.argv[1])

                </code></pre>
            </section>
            <section>
                <h1 class="r-fit-text">–ü–æ—Å—Ç–∞–≤–∏–º Postgres –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤</h1>
                <img src="images/postgresql-15-installation.jpg" alt="">
            </section>
            <section>
                <p>–ü–µ—Ä–µ–ø–∏—à–µ–º –º–µ—Ç–æ–¥ read</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 15px;">
                    def read(self, path, length, offset, fh):
                        print(path, length, offset, fh)
                        if re.match(r'/installed_postgres/data/.*', path) and random.random() < 0.5:
                            return b''  # Return an empty byte string as a no-op
                        else:
                            os.lseek(fh, offset, os.SEEK_SET)
                            return os.read(fh, length)
                </code></pre>
            </section>
            <section>
                <h1 class="r-fit-text">Postgres —Ä–∞–±–æ—Ç–∞–µ—Ç</h1>
                <img src="images/postgress-install-success.png" alt="">
            </section>
            <section>
                <p>–ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É</p>
                <p>–ü–æ—Å—Ç–≥—Ä–µ—Å –Ω–µ –ø–æ–¥–º–µ–Ω—è–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã?</p>
                <img src="images/pofig.png" alt="">
            </section>
            <section>
                <h2 class="r-fit-text">–ù–æ –ø–æ—á–µ–º—É —Ç–∞–∫ –≤—ã—à–ª–æ?</h2>
                <p>–Ø –≤—ã—è—Å–Ω–∏–ª, –µ—Å–ª–∏ –ø–∏—Å–∞—Ç—å —Ñ–∞–π–ª –≤ basedir, —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–æ–¥–º–µ–Ω—è–µ—Ç. –ù–æ –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø–∏—à–µ—à—å –≤ mntdir ‚Äî –≤—Å—ë –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è. <br>–ö–∞–∫ –∑–∞—Å—Ç–∞–≤–∏—Ç—å PostgreSQL —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ mntdir, —á—Ç–æ–±—ã –æ–Ω —Ç–æ–∂–µ –≤—Å—ë –ª–æ–≥–∏—Ä–æ–≤–∞–ª?</p>
            </section>
            <section>
                <p>–°–∞–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 15px;">
                    $ echo "test str" > data/example.txt
                    $ echo "test str 2" > mntpoint/example.txt 
                </code></pre>
                <p>–û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞, –ª–æ–≥–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 15px;">
                    $ python3 fs2.py data mntpoint            
                    /example.txt b'test str 2\n' 0 4
                </code></pre>
                <p>–ü–æ–Ω—è–ª —á—Ç–æ–±—ã –≤—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ –Ω–∞–¥–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é pgdata –∏–º–µ–Ω–Ω–æ –≤–Ω—É—Ç—Ä–∏ mntpoint –∏ –Ω–∞ –Ω–µ–µ –∑–∞–ø—É—Å–∫–∞—Ç—å pginit</p>
            </section>
            <section>
                <p>–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –æ—Ç Postgres –Ω–∞—á–∞–ª–∏ –ø–æ—è–≤–ª—è—Ç—Å—è</p>
                <img src="images/fun-big-logs.jpg" alt="">
            </section>
            <section>
                <p>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–∫–∏ read –≤ 50% —Å–ª—É—á–∞–µ–≤ –ø—Ä–∏–≤–µ–ª–æ –∫ –æ—à–∏–±–∫–µ –∑–∞–ø–∏—Å–∏ —Å—Ç—Ä–æ—á–µ–∫ –≤ –ë–î</p>
                <img src="images/not-inserted.jpg" alt="" height="400px">
            </section>
            <section>
                <p>–°–∏–º—É–ª—è—Ü–∏—è —Ç–æ–≥–æ —á—Ç–æ –∫–æ–Ω—á–∏–ª–∏—Å—å Inode</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 15px;">
                    def create(self, path, mode, fi=None):
                        if random.random() < 0.5:
                            raise FuseOSError(errno.ENOSPC)
                        ...
                </code></pre>
                <img src="images/inodes-empty-error.jpg" alt="">
            </section>
            <section>
                <p>–°–∏–º—É–ª—è—Ü–∏—è —Ç–æ–≥–æ —á—Ç–æ –∫–æ–Ω—á–∏–ª–∏—Å—å Inode –≤ Postgres</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 13px;">
                    durachok=# CREATE TABLE random_names2 (
                        name VARCHAR(1)                                         
                    );
                    ERROR:  could not create file "base/16384/24576": –ù–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
                    durachok=# INSERT INTO random_names (name)
                    SELECT chr((random() * 26)::integer + 65)::character varying
                    FROM generate_series(1, 500000);
                    ERROR:  could not read file "base/pgsql_tmp/pgsql_tmp57981.0": –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Ñ–∞–π–ª–∞
                    durachok=# INSERT INTO random_names (name)
                    SELECT chr((random() * 26)::integer + 65)::character varying
                    FROM generate_series(1, 10);
                    INSERT 0 10
                    durachok=#     
                </code></pre>
            </section>
            <section>
                <p>–ì–∏–±–∫–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Fuse</p>
                <pre><code data-line-numbers="" data-trim data-noescape style="font-size: 13px;">
                    def create(self, path, mode, fi=None):
                        with open('t.txt', 'r') as file:
                            first_character = file.read(1)
            
                            if random.random() < 0.5 and first_character == '1':
                                raise FuseOSError(errno.ENOSPC)
            
                        ...
                </code></pre>
            </section>
            <section>
                <h1 style="font-size: 50px !important;">–ò—Ç–æ–≥–∏</h1>
                <ul>
                    <li>üò≠ –ú–Ω–µ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–ª–æ–º–∞—Ç—å Postgres</li>
                    <li>üõ† –ü–æ—Å–º–æ—Ç—Ä–µ–ª –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –æ–±–ª–∞—Å—Ç–∏ —Å–∏–º—É–ª—è—Ü–∏–∏ –æ—à–∏–±–æ–∫ –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª –∏—Ö</li>
                    <li>üçè –ù–∞–ø–∏—Å–∞–ª —Å–≤–æ—é —Ñ–∞–π–ª–æ–≤—É—é –≤ UserSpace, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –∏ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–∞–∫–æ–π fuzzing –≤ –±—É–¥—É—â–µ–º –ø—Ä–∏–Ω–µ—Å–µ—Ç –ø–ª–æ–¥—ã</li>
                </ul>
            </section>
            <section>
                <h1 class="r-fit-text">–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ!<br> QA?</h1>
            </section>
        </div>
    </div>
    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
    Reveal.initialize({
        slideNumber: true,
        hash: true,
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
    });
    </script>
</body>

</html>